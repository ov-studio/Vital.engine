name: Pull Request Verification

on:
  pull_request

jobs:
  windows:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v2
    - uses: nuget/setup-nuget@v1
      with:
        nuget-api-key: ${{ secrets.NuGetAPIKey }}
    - run: nuget restore vEngine.sln
    - name: Build
      shell: cmd
      run: |
        "C:/Program Files (x86)/Microsoft Visual Studio/2019/Enterprise/MSBuild/Current/Bin/MSBuild.exe" vEngine.sln /t:OfflineShaderCompiler /m /p:Configuration=Release /p:Platform=x64
        cd "vEngine"
        "../BUILD/x64/Release/OfflineShaderCompiler/OfflineShaderCompiler.exe" hlsl6 spirv shaderdump
        cd ..
        "C:/Program Files (x86)/Microsoft Visual Studio/2019/Enterprise/MSBuild/Current/Bin/MSBuild.exe" vEngine.sln /t:rebuild /m /p:Configuration=Release /p:Platform=x64
    
    - name: Move binaries
      shell: cmd
      run: |
        move BUILD\x64\Release\Editor_Windows\Editor_Windows.exe Editor\

        move BUILD\x64\Release\Tests\Tests.exe Tests\
        
    - name: Package Editor
      uses: actions/upload-artifact@v2
      with:
        name: Editor (Windows x64)
        path: |
          Content/
          README.md
          LICENSE
          Editor/images/
          Editor/sound/
          Editor/*.ini
          Editor/*.ico
          Editor/*.lua
          Editor/*.exe